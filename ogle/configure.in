dnl Process this file with autoconf to produce a configure script.
AC_INIT(ac3/ac3dec_wrap.c)
AC_CANONICAL_HOST

dnl Checks for programs.
AC_PROG_CC

dnl Checks for libraries.

dnl Checks for header files.
GLIB_CFLAGS=`glib-config --cflags`
AC_SUBST(GLIB_CFLAGS)

dnl Find X Window System
AC_PATH_XTRA
AC_CHECK_HEADER(X11/extensions/Xv.h, AC_DEFINE(HAVE_XV))
AC_CHECK_HEADER(X11/extensions/XShm.h, AC_DEFINE(HAVE_XSHM))

dnl AC_CHECK_HEADER($x_includes/X11/extensions/Xvlib.h, AC_DEFINE(HAVE_XV))

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_BIGENDIAN

dnl Checks for library functions.
AC_CHECK_LIB(Xext,main,XEXT_LIB=-lXext,AC_MSG_ERROR(You need libXext),$X_LIBS -lX11 $X_EXTRA_LIBS)
AC_SUBST(XEXT_LIB)

AC_CHECK_LIB(Xv,XvQueryExtension,XEXT_LIB="$XEXT_LIB -lXv",AC_MSG_WARN(You won't bw able to use Xv),$X_LIBS -lXext)

dnl AC_CHECK_LIB(Xext,XShmQueryExtension,XEXT_LIB="$XEXT_LIB -lXext",AC_MSG_WARN(You won't be able to use XShm),$X_LIBS -lX11)
AC_CHECK_LIB(jpeg,main,XEXT_LIB="$XEXT_LIB -ljpeg",AC_MSG_ERROR(You need libjpeg),$X_LIBS -lX11 $X_EXTRA_LIBS)

AC_SEARCH_LIBS(sem_init, [rt pthread posix4],,AC_MSG_ERROR(You need sem_init))



dnl Sun MediaLib
AC_ARG_ENABLE(mlib,
  [  --disable-mlib          make a version not using mediaLib],
  enable_mlib=no, enable_mlib=yes)
if test x$enable_mlib = xyes; then
  AC_CHECK_LIB(mlib, main,
                [ MLIB_CFLAGS="-I/opt/SUNWmlib/include"
                MLIB_LIBS="-L/opt/SUNWmlib/lib -R/opt/SUNWmlib/lib -lmlib"
                AC_DEFINE(HAVE_MLIB,1,[Solaris MultiMedia Library installed]) ],                , -L/opt/SUNWmlib/lib -R/opt/SUNWmlib/lib)
else
        have_mlib=no
fi
AC_SUBST(MLIB_CFLAGS)
AC_SUBST(MLIB_LIBS)

CFLAGS="$CFLAGS -Wall"

dnl Architecture specific stuff
USE_MMX=
case "$host_cpu" in
i?86)
	case "$host_cpu" in
	i386 | i486)
		;;
	i686)
		AC_DEFINE(HAVE_MMX)
		USE_MMX=yes
		CFLAGS="$CFLAGS -fomit-frame-pointer -funroll-loops -malign-double"
		;;
	*)
		AC_DEFINE(HAVE_MMX)
		USE_MMX=yes
		;;
	esac
	CFLAGS="$CFLAGS -march=$host_cpu"
	;;
sparc)
	CFLAGS="$CFLAGS -mcpu=ultrasparc -mvis"
esac
AC_SUBST(USE_MMX)

case "$host_os" in
linux-gnu)
	AC_DEFINE(USE_SYSV_SEM)
	;;
*)
	AC_DEFINE(USE_POSIX_SEM)
	;;
esac



AC_CHECK_FUNCS(clock_gettime madvise)

INCLUDES='-I. -I$(top_srcdir)/include -I- -I/usr/pd/include'
dnl AC_SUBST(INCLUDES)
CFLAGS="$INCLUDES $CFLAGS"

AC_OUTPUT(ctrl/Makefile ui/Makefile ac3/Makefile mpeg2_video/Makefile Makefile vmg/Makefile mpeg_audio/Makefile mpeg2_program/Makefile subpicture/Makefile)

